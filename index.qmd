---
title: "Météo Montpellier"
---
```{python}
#| code-fold: true
#| code-summary: "Dérouler le code"
import numpy as np
import matplotlib.pyplot as plt
import requests
import datetime
import pooch
import PIL as Image
import statistics
from dateutil.relativedelta import relativedelta
start_date = datetime.datetime.now() - relativedelta(days=3)
end_date = start_date + relativedelta(days=6)

debut=""
if (start_date.month <10 and start_date.day <10):
    debut = f"{start_date.year}-0{start_date.month}-0{start_date.day}"
elif start_date.day <10:
    debut = f"{start_date.year}-{start_date.month}-0{start_date.day}"
elif start_date.month <10:
    debut = f"{start_date.year}-0{start_date.month}-{start_date.day}"
else:
    debut = f"{start_date.year}-{start_date.month}-{start_date.day}"


print(debut)
fin=""
if (end_date.month <10 and end_date.day <10):
    fin = f"{end_date.year}-0{end_date.month}-0{end_date.day}"
elif end_date.day <10:
    fin = f"{end_date.year}-{end_date.month}-0{end_date.day}"
elif start_date.month <10:
    fin = f"{end_date.year}-0{end_date.month}-{end_date.day}"
else:
    fin = f"{end_date.year}-{end_date.month}-{end_date.day}"

print(fin)
url = f"https://api.open-meteo.com/v1/meteofrance?latitude=43.6&longitude=3.8833&hourly=temperature_2m,relativehumidity_2m,apparent_temperature,precipitation,rain,snowfall,weathercode,cloudcover,windspeed_10m,windspeed_20m,temperature_20m&start_date={debut}&end_date={fin}"


response = requests.get(url)
data = response.json()
print(data)
degres=data['hourly']['temperature_2m']
ressenti=data['hourly']['apparent_temperature']
humidite=data['hourly']['relativehumidity_2m']
pluie=data['hourly']['precipitation']
neige=data['hourly']['snowfall']
vent=data['hourly']['windspeed_10m']
codeimage=data['hourly']['weathercode']

print(codeimage)
tabcode = np.zeros((7,24))
tabdegres = np.zeros((7,24))
k=0
for i in range(7):
    for j in range(24):
        tabdegres[i,j]= degres[k]
        k+=1
mintemp=np.zeros(7)
maxtemp=np.zeros(7)
for i in range(7):
    mintemp[i]=min(tabdegres[i])
    maxtemp[i]=max(tabdegres[i])

medcode=np.zeros(7)
k=0
for i in range(7):
    for j in range(24):
        tabcode[i,j]= codeimage[k]
        k+=1

for i in range(7): 
    medcode[i]=statistics.median(tabcode[i])


def inttoday(i):
    if ((datetime.datetime.now().weekday() + i)%7 ==0):
        return 'Lundi'
    elif ((datetime.datetime.now().weekday()+i)%7 ==1):
        return 'Mardi'
    elif ((datetime.datetime.now().weekday()+i)%7 ==2):
        return 'Mercredi'
    elif ((datetime.datetime.now().weekday()+i)%7 ==3):
        return 'Jeudi'
    elif ((datetime.datetime.now().weekday()+i)%7 ==4):
        return 'Vendredi'
    elif ((datetime.datetime.now().weekday()+i)%7 ==5):
        return 'Samedi'
    else:
        return 'Dimanche'
#| label: tbl-planets
#| tbl-cap: Astronomical object
def imgcode(i):
    if (medcode[i]==0):
        return 'iconsmeteo/Sun-thin.svg'
    elif (medcode[i]==1 or medcode[i]==2):
        return 'iconsmeteo/PartlySunny-thin.svg'
    elif (medcode[i]==3):
        return 'iconsmeteo/Cloud-thin.svg'

from IPython.display import Markdown
from IPython.display import HTML
from tabulate import tabulate
res=f"""
<table class= "table1-style">
    <thead>
    <tr>  
        <th style = "text-align : center"> Jours </th>
        <th style = "text-align : center">  {inttoday(-2)}</th>
        <th style = "text-align : center">  Hier</th>
        <th style = "text-align : center">  Aujourd'hui</th>
        <th style = "text-align : center">  Demain</th>
        <th style = "text-align : center">  {inttoday(2)}</th>
        <th style = "text-align : center">  {inttoday(3)}</th>
        <th style = "text-align : center">  {inttoday(4)}</th>
    </tr>
    </thead>
    <tbody>
    <tr> 
        <td>  icone</td>
        <td> <img src={imgcode(0)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(1)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(2)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(3)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(4)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(5)} width="50"
  height="50" /> </td>
        <td> <img src={imgcode(6)} width="50"
  height="50" /> </td>
    </tr>
    <tr> 
        <td>  température maximale</td>
        <td> {maxtemp[0]} </td>
        <td> {maxtemp[1]} </td>
        <td> {maxtemp[2]} </td>
        <td> {maxtemp[3]} </td>
        <td> {maxtemp[4]} </td>
        <td> {maxtemp[5]} </td>
        <td> {maxtemp[6]} </td>
    </tr>
    <tr> 
        <td>  température minimale</td>
        <td> {mintemp[0]} </td>
        <td> {mintemp[1]} </td>
        <td> {mintemp[2]} </td>
        <td> {mintemp[3]} </td>
        <td> {mintemp[4]} </td>
        <td> {mintemp[5]} </td>
        <td> {mintemp[6]} </td>
    </tr>
    </tbody>

</table>
"""
display(HTML(res))
```